window.DlMap=window.DlMap||{};window.DlListings=window.DlListings||{};(function(_,Backbone,DlListings,DlMap,dllocalized){"use strict";document.addEventListener("DOMContentLoaded",function(){DlListings.Backbone={};DlListings.Backbone.Models={Listings:Backbone.Model.extend({}),FoundPosts:Backbone.Model.extend({defaults:{number:null,numberOf:null,label:"",currObjLabel:"",numSeparator:""}}),ArchiveDescription:Backbone.Model.extend({}),Pagination:Backbone.Model.extend({defaults:{markup:null}})};DlListings.Backbone.Views={Listings:Backbone.View.extend({events:{mouseenter:"highlightPin",mouseleave:"highlightPin"},initialize:function(){this.model.on("delete",this.remove.bind(this));this.model.on("update",this.render.bind(this))},remove:function(){if(!this.el){return}this.el.remove()},render:function(){var container=document.querySelector(".dllistings-list");if(!container){return}var grid=container.querySelector(".dlgrid");if(!grid){grid=document.createElement("div");grid.classList.add("dlgrid");container.insertBefore(grid,container.firstElementChild)}container=grid;var postHtml=this.model.get("postHtml");if(postHtml){container.insertAdjacentHTML("beforeEnd",postHtml);setTimeout(function(){this.el=document.getElementById("post-"+this.model.get("ID"));this.el.addEventListener("mouseenter",this.highlightPin.bind(this));this.el.addEventListener("mouseleave",this.highlightPin.bind(this))}.bind(this),0)}},highlightPin:function(e){var slug=this.el.getAttribute("data-marker");var markerEl=document.getElementsByClassName("data-marker-slug-"+slug)[0];if(!markerEl){return}switch(e.type){case"mouseenter":markerEl.classList.add("dlmap-marker--hover");break;case"mouseleave":markerEl.classList.remove("dlmap-marker--hover");break}}}),FoundPosts:Backbone.View.extend({el:null,initialize:function(){this.model.on("change",this.render.bind(this))},render:function(){var data={number:{data:this.model.get("number"),selector:".dlposts-found__number"},numberOf:{data:this.model.get("numberOf"),selector:".dlposts-found__of"},numSep:{data:this.model.get("numSeparator"),selector:".dlposts-found__number-separator"},currObjLabel:{data:this.model.get("currObjLabel"),selector:".dlposts-found__current-page-label"}};_.forEach(data,function(el){this.updateFoundPosts(el.data,el.selector)}.bind(this))},updateFoundPosts:function(data,selector){var elems=document.querySelectorAll(selector);if(!elems.length){return}_.forEach(elems,function(elem){elem.innerHTML=data})}}),ArchiveDescription:Backbone.View.extend({el:null,initialize:function(){this.model.on("change",this.render.bind(this))},render:function(){var data={description:{data:this.model.get("description"),selector:".dlarchive-description__content"}};_.forEach(data,function(el){this.updateArchiveDescription(el.data,el.selector)}.bind(this))},updateArchiveDescription:function(data,selector){var elem=document.querySelector(selector);if(!elem){return}elem.innerHTML=data}}),Pagination:Backbone.View.extend({el:".dlpagination",initialize:function(){this.model.on("change",this.render.bind(this))},render:function(){try{var dynamicEl=document.querySelector(".dlpagination"),markup=this.model.get("markup");if(!this.el&&!markup&&dynamicEl){dynamicEl.remove();return}if(!markup&&this.el){this.el.remove();this.el=null;return}if(!markup){return}if(!this.el){this.el=dynamicEl;if(!this.el){var container=document.querySelector(".dlarchive-listings-footer__right");if(!container){return}this.el=document.createElement("div");this.el.innerHTML=markup;this.el=this.el.firstElementChild;container.appendChild(this.el)}}this.el.innerHTML="";this.el.innerHTML=markup}catch(e){"dev"===window.dllocalized.env&&console.warn(e)}}})};DlListings.Backbone.Collections={Listings:Backbone.Collection.extend({parse:function(response){if(typeof response.posts==="undefined"){return[]}return response.posts},initialize:function(){_.bindAll(this,"removeCb","addCb");this.on("reset",this.removeCb);this.on("add",this.addCb)},removeCb:function(collection,options){_.forEach(options.previousModels,function(model){model.trigger("delete")});return this},addCb:function(model){new DlListings.Backbone.Views.Listings({model:model,el:"#post-"+parseInt(model.get("ID"))})}})}})})(_,Backbone,window.DlListings,window.DlMap,window.dllocalized);