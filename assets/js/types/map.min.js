window.DL=window.DL||{};(function(DL){"use strict";function gmapReInit(map,mapOptions){google.maps.event.trigger(map,"resize");map.setCenter(mapOptions.center)}function setDragEventOnMarker(marker,gmapEl,searcher){marker.addListener("dragend",function(coords){var geocoder=new google.maps.Geocoder;geocoder.geocode({location:coords.latLng},function(results,status){if("OK"!==status){return}var place=results[0];var locationStringFormat=place.geometry.location.lat()+","+place.geometry.location.lng()+":"+place.formatted_address;gmapEl.value=locationStringFormat;searcher.value=place.formatted_address})})}window.addEventListener("load",function(){var gmapDataRef=document.querySelectorAll(".dl-gmap-input-searcher");if(!gmapDataRef.length){return false}[].forEach.call(gmapDataRef,function(gmapEl){var latlng,address="";if(gmapEl.getAttribute("value")){var gmapElVal=gmapEl.getAttribute("value").split(":");address=gmapElVal[1];latlng=gmapElVal[0].split(",").map(function(el){return parseFloat(el)})}var searcher=document.createElement("input");searcher.setAttribute("type","text");searcher.setAttribute("name",gmapEl.getAttribute("name")+"_searcher");searcher.setAttribute("id",gmapEl.getAttribute("id")+"_searcher");searcher.setAttribute("value",address);searcher.setAttribute("placeholder","Start typing the address to see suggestions");searcher.addEventListener("change",function(){if(!this.value){gmapEl.setAttribute("value","")}});_.forEach(gmapEl.classList,function(elem){searcher.classList.add(elem)});gmapEl.parentNode.insertBefore(searcher,gmapEl);gmapEl.classList.add("screen-reader-text");var searchInputID=searcher.getAttribute("id");var gmapWrapper=document.createElement("div"),gmapPos=gmapEl.getAttribute("data-append-map-to"),gmapPosEl=gmapEl;if(gmapPos){var cPl=0;while(!gmapPosEl.parentElement.classList.contains(gmapPos)){gmapPosEl=gmapPosEl.parentElement;if(10<=++cPl){break}}}gmapWrapper.classList.add("gmap-wrapper");gmapWrapper.classList.add("u-cf");gmapWrapper.style.clear="both";gmapPosEl.parentElement.appendChild(gmapWrapper);var gmapOptionsByID=DL.Utils.String.variablizeString(gmapEl.getAttribute("id")),gmapOptions=window[gmapOptionsByID]||{};if(latlng){gmapOptions.center={lat:latlng[0],lng:latlng[1]}}var map=new google.maps.Map(gmapWrapper,gmapOptions);if(!latlng){gmapWrapper.style.display="none"}var marker=new google.maps.Marker({position:gmapOptions.center,draggable:true,map:map});setDragEventOnMarker(marker,gmapEl,searcher);document.addEventListener("dl-tab-opened",function(){gmapReInit(map,gmapOptions)});var searchBox=new google.maps.places.SearchBox(searcher);searchBox.addListener("places_changed",function(){var place=searchBox.getPlaces()[0];if(!place){return}gmapWrapper.style.display="block";gmapReInit(map,gmapOptions);marker.setMap(null);gmapEl.setAttribute("value",place.geometry.location.lat()+","+place.geometry.location.lng()+":"+place.formatted_address);map.setCenter(place.geometry.location);marker=new google.maps.Marker({map:map,draggable:true,title:place.name,position:place.geometry.location});setDragEventOnMarker(marker,gmapEl,searcher)});document.addEventListener("keypress",function(e){if(13===e.keyCode&&searchInputID===e.target.getAttribute("id")){e.preventDefault()}})})})})(window.DL);