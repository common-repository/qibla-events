window.DlTypes=window.DlTypes||{};(function(_,$,DlTypes,Dropzone,dllocalized){"use strict";DlTypes.getDropzone=function(form){var DropzoneInputs={form:null,dropzoneCollection:[],createInputContainer:function(wrapper,input){var container=document.createElement("div");container.appendChild(input);container.classList.add("dropzone");wrapper.appendChild(container);return container},getDropzoneOptions:function(input){return _.extend({url:window.dllocalized.site_url+"/index.php",previewTemplate:document.querySelector("#dropzone_template").innerHTML},window[input.dataset.dzref])},processDropzoneFiles:function(evt){_.forEach(this.dropzoneCollection,function(dropzone){if(!_.isUndefined(evt.detail.dropzoneCb)&&!_.isEmpty(evt.detail.dropzoneCb)){_.forEach(evt.detail.dropzoneCb,function(item){dropzone.on(item.name,function(){return item.cb.apply(dropzone,arguments)})})}dropzone.processQueue()})},initializeDropzone:function(){this.inputs=_.filter(this.form.querySelectorAll('input[type="file"]'),function(input){return input.classList.contains("use-dropzone")});if(!this.inputs.length){this.inputs=[]}_.forEach(this.inputs,function(input){var container=this.createInputContainer(input.parentNode,input);input.style.display="none";var dzInstance=new Dropzone(container,this.getDropzoneOptions(input)),dzrefFilesData=dzInstance.options.dzrefFilesData;if(dzrefFilesData.length){_.forEach(dzrefFilesData,function(mockFile){dzInstance.options.addedfile.call(dzInstance,mockFile);dzInstance.files.push(mockFile);dzInstance.options.thumbnail.call(dzInstance,mockFile,mockFile.url)}.bind(this))}this.dropzoneCollection.push(dzInstance);this.form.addEventListener("ajax-form-submit-files",this.processDropzoneFiles)}.bind(this))},init:function(){this.initializeDropzone()},construct:function(form){this.form=form;Dropzone.autoDiscover=false;_.bindAll(this,"createInputContainer","initializeDropzone","processDropzoneFiles");return this}};return DropzoneInputs.construct(form)}})(_,window.jQuery,window.DlTypes,window.Dropzone,window.dllocalized);