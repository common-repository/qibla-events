window.DL=window.DL||{};(function(_,$,DL,dlreview){"use strict";DL.Review={ReplyForm:{showCancelReply:function(element){var cancelReplyLink=element.querySelector("#cancel-comment-reply-link");cancelReplyLink.style.display="inline";DL.Utils.Events.addListener(cancelReplyLink,"click",function(evt){evt.preventDefault();evt.stopImmediatePropagation();this.restoreForm(element)}.bind(this))},setReplyLabels:function(form,container){var titleEl=form.querySelector("#reply-title"),titleSmallEl=titleEl.querySelector("small");titleEl.setAttribute("data-oldtext",titleEl.innerHTML);titleEl.innerHTML=window.dlreview.formLabels.replyTitle.replace("%s",'<span class="u-highlight-text">'+container.querySelector(".comment-author").innerText+"</span>");titleEl.appendChild(titleSmallEl);this.showCancelReply(form);var commentFormCommentEl=form.querySelector(".comment-form-comment label");commentFormCommentEl.setAttribute("data-oldtext",commentFormCommentEl.innerText);commentFormCommentEl.innerText=window.dlreview.formLabels.textAreaLabel;var submitEl=form.querySelector('input[type="submit"]');submitEl.setAttribute("data-oldtext",submitEl.value);submitEl.value=window.dlreview.formLabels.submitLabel},restoreReviewLabels:function(form){var titleEl=form.querySelector("#reply-title");titleEl.innerHTML=titleEl.getAttribute("data-oldtext");var commentFormCommentEl=form.querySelector(".comment-form-comment label");commentFormCommentEl.innerText=commentFormCommentEl.getAttribute("data-oldtext");var submitEl=form.querySelector('input[type="submit"]');submitEl.value=submitEl.getAttribute("data-oldtext")},setParentCommentAttributeValue:function(form,parentID){parentID=parseInt(parentID);if(parentID){form.querySelector("#comment_parent").value=parentID}},resetParentCommentAttributeValue:function(form){form.querySelector("#comment_parent").value=0},moveForm:function(element){var refContainer=element.getAttribute("data-container");if(refContainer){refContainer=document.getElementById(refContainer);if(refContainer.parentNode.querySelector(".comment-respond")){return}var form=document.querySelector(".comment-respond");if(form&&refContainer.parentNode.appendChild(form)){this.setReplyLabels(form,refContainer);this.setParentCommentAttributeValue(form,element.getAttribute("data-id"))}}},restoreForm:function(form){document.querySelector(".dlcomments").appendChild(form);this.restoreReviewLabels(form);this.resetParentCommentAttributeValue(form)},init:function(){var replyLinks=document.querySelectorAll(".comment-reply-link");if(!replyLinks.length){return false}_.forEach(replyLinks,function(link){DL.Utils.Events.addListener(link,"click",function(evt){evt.preventDefault();evt.stopPropagation();this.moveForm(evt.target)}.bind(this))}.bind(this));return this},construct:function(){_.bindAll(this,"showCancelReply","setReplyLabels","restoreReviewLabels","setParentCommentAttributeValue","resetParentCommentAttributeValue","moveForm","restoreForm","init");return this}},Rating:{hideDefaultRatingField:function(){this.ratingList.style.display="none"},createStarRating:function(){if(!this.field.querySelector(".dlreview-form__rating-stars")){var stars='<p class="dlreview-form__rating-stars stars selected">';_.forEach(this.field.querySelectorAll('[name="qibla_mb_comment_rating"]'),function(el,index){var attrClass="dlreviews__star"+(el.checked?" active":"");stars+='<a class="'+attrClass+'" href="#" data-value="'+el.getAttribute("value")+'">'+ ++index+"</a>"});stars+="</p>";return stars}},setRatingValue:function(evt){evt.preventDefault();evt.stopPropagation();this.stars.classList.add("selected");_.forEach(this.stars.querySelectorAll(".dlreviews__star"),function(el){el.classList.remove("active")});evt.target.classList.add("active");this.ratingList.querySelector('[value="'+evt.target.getAttribute("data-value")+'"]').checked=true},init:function(){var stars=document.querySelector(".dlreview-form__rating-stars");DL.Utils.Events.addListener(stars,"mouseenter",function(evt){DL.Utils.Functions.classList(evt.target).remove("selected")});DL.Utils.Events.addListener(stars,"mouseleave",function(evt){DL.Utils.Functions.classList(evt.target).add("selected")});_.forEach(this.field.querySelectorAll(".dlreviews__star"),function(el){DL.Utils.Events.addListener(el,"click",this.setRatingValue.bind(this))}.bind(this));return this},construct:function(){this.field=document.querySelector(".dlreview-form__rating");if(!this.field){return false}this.ratingList=this.field.querySelector("ul");var markup=this.createStarRating();this.field.insertAdjacentHTML("beforeend",markup);this.stars=this.field.querySelector(".dlreview-form__rating-stars");this.hideDefaultRatingField();return this}}};window.addEventListener("load",function(){if(DL.Utils.Functions.classList(document.body).contains("dl-is-singular-listings")){DL.Review.ReplyForm.construct().init();if(DL.Review.Rating.construct()){DL.Review.Rating.init()}}})})(window._,window.jQuery,window.DL,window.dlreview);